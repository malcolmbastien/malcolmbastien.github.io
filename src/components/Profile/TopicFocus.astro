---
import { getCollection } from "astro:content";

const allNotes = await getCollection("notes");

// Aggregate topic counts
const topicCounts: Record<string, number> = {};
allNotes.forEach((note) => {
    note.data.tags.forEach((tag: string) => {
        topicCounts[tag] = (topicCounts[tag] || 0) + 1;
    });
});

// Get top 16 topics by count
const topTopics = Object.entries(topicCounts)
    .sort(([, a], [, b]) => b - a)
    .slice(0, 16);
---

<section class="bg-white dark:bg-slate-800 p-6 rounded-xl border border-slate-200 dark:border-slate-700 shadow-sm">
    <h3 class="text-xs font-bold uppercase tracking-[0.2em] text-slate-400 mb-6">Topics</h3>
    <div
        class="flex flex-wrap gap-x-4 gap-y-3"
    >
        {
            topTopics.map(([topic, count]) => (
                <a
                    href={`/topics/${topic}`}
                    class="group flex items-baseline gap-2"
                >
                    <span class="text-sm font-bold text-black dark:text-white group-hover:text-blue-500 dark:group-hover:dark:text-blue-400 transition-colors">#{topic}</span>
                    <span class="text-xs text-slate-400 group-hover:text-blue-500  dark:group-hover:dark:text-blue-400 transition-colors">{count}</span>
                </a>
            ))
        }
    </div>
    <div class="mt-8 pt-6 border-t border-slate-50 dark:border-slate-700">
        <a
            href="/topics"
            class="text-xs font-bold uppercase tracking-widest text-slate-400 hover:text-black dark:hover:text-white transition-colors"
        >
            Explore All Topics â†’
        </a>
    </div>
</section>
