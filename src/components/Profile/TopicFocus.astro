---
import { getCollection } from "astro:content";

const allNotes = await getCollection("notes");

const topicCounts: Record<string, number> = {};
allNotes.forEach((note) => {
    note.data.tags.forEach((tag: string) => {
        topicCounts[tag] = (topicCounts[tag] || 0) + 1;
    });
});

const topTopics = Object.entries(topicCounts)
    .sort(([, a], [, b]) => b - a)
    .slice(0, 8);
---

<div>
    <h4 class="text-base font-semibold text-slate-700 mb-6">Popular Topics</h4>
    
    <div class="flex flex-wrap gap-2">
        {
            topTopics.map(([topic, count]) => (
                <a
                    href={`/topics/${topic}`}
                    class="px-3 py-1.5 bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded text-sm font-medium text-slate-600 dark:text-slate-300 hover:border-primary transition-colors flex items-center gap-2"
                >
                    #{topic} <span class="text-xs text-slate-400">{count}</span>
                </a>
            ))
        }
    </div>
    
    <a
        href="/topics"
        class="inline-block mt-6 text-xs font-semibold text-primary dark:text-blue-400 hover:underline"
    >
        Browse all topics â†’
    </a>
</div>
