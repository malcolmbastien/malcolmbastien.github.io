---
import { getCollection } from "astro:content";

const allPosts = await getCollection("posts");

// Aggregate tag counts
const tagCounts: Record<string, number> = {};
allPosts.forEach((post) => {
    post.data.tags.forEach((tag) => {
        tagCounts[tag] = (tagCounts[tag] || 0) + 1;
    });
});

// Get top 12 tags sorted alphabetically
const topTags = Object.entries(tagCounts)
    .sort(([a], [b]) => a.localeCompare(b))
    .slice(0, 12);
---

<div
    class="bg-white dark:bg-[#121812] border border-slate-200 dark:border-slate-800 rounded-xl p-4"
>
    <h3 class="text-sm font-semibold text-slate-900 dark:text-slate-100 mb-4">
        Tags
    </h3>
    <div
        class="grid grid-cols-2 sm:grid-cols-1 md:grid-cols-2 lg:grid-cols-2 gap-1.5"
    >
        {
            topTags.map(([tag, count]) => (
                <a
                    href={`/tags/${tag}`}
                    class="tag-btn flex items-center justify-between rounded-lg px-2.5 py-1.5 transition-colors w-full text-left"
                >
                    <span class="text-xs font-medium capitalize">#{tag}</span>
                    <span class="text-xs font-bold">{count}</span>
                </a>
            ))
        }
    </div>
    <a
        href="/categories"
        class="block text-center text-xs font-medium text-slate-600 dark:text-slate-400 hover:text-emerald-600 dark:hover:text-emerald-400 mt-3 transition-colors"
    >
        View all tags â†’
    </a>
</div>

<style is:global>
    .tag-btn {
        background-color: rgb(241 245 249);
        border: 1px solid rgb(226 232 240);
        color: rgb(15 23 42);
        transition: all 0.2s;
        text-decoration: none;
    }
    .tag-btn:hover {
        background-color: rgb(248 250 252);
        color: rgb(15 23 42);
    }
    .dark .tag-btn {
        background-color: transparent !important;
        border-color: rgb(71 85 105) !important;
        color: rgb(203 213 225) !important;
    }
    .dark .tag-btn:hover {
        background-color: rgb(51 65 85) !important;
        color: rgb(203 213 225) !important;
    }
</style>
