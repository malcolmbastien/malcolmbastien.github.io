---
import { getCollection } from 'astro:content';

const allPosts = await getCollection('posts');

// Aggregate tag counts
const tagCounts: Record<string, number> = {};
allPosts.forEach(post => {
	post.data.tags.forEach(tag => {
		tagCounts[tag] = (tagCounts[tag] || 0) + 1;
	});
});

// Get top 8 tags
const topTags = Object.entries(tagCounts)
	.sort(([,a], [,b]) => b - a)
	.slice(0, 8);
---

<div class="bg-white dark:bg-[#121812] border border-slate-200 dark:border-slate-800 rounded-xl p-4">
	<h3 class="text-xs font-bold text-slate-400 uppercase tracking-widest mb-3">Topic Focus</h3>
	<div class="grid grid-cols-5 gap-1.5">
		{topTags.map(([tag, count]) => (
			<button class="tag-btn flex items-center justify-between rounded-lg px-2.5 py-1.5 transition-colors w-full text-left" data-tag={tag}>
				<span class="text-xs font-medium capitalize">#{tag}</span>
				<span class="text-xs font-bold">{count}</span>
			</button>
		))}
	</div>
</div>

<style is:global>
	.tag-btn {
		background-color: rgb(255 255 255);
		border: 1px solid rgb(226 232 240);
		color: rgb(15 23 42);
		transition: all 0.2s;
	}
	.tag-btn:hover {
		background-color: rgb(248 250 252);
	}
	.tag-btn.active {
		background-color: oklch(40.5% 0.101 131.063);
		color: white !important;
		border-color: rgb(15 23 42) !important;
	}
	.dark .tag-btn {
		background-color: rgb(30 41 59);
		border-color: rgb(51 65 85);
		color: rgb(241 245 249);
	}
	.dark .tag-btn:hover {
		background-color: rgb(51 65 85);
	}
	.dark .tag-btn.active {
		background-color: rgb(241 245 249) !important;
		color: rgb(15 23 42) !important;
		border-color: rgb(241 245 249) !important;
	}
</style>
