---
import { getFileHistory } from '../../lib/git-history';

interface Props {
	filePath: string;
}

const { filePath } = Astro.props;
const history = await getFileHistory(filePath);
---

<div class="mt-12 pt-8 border-t border-slate-200">
	<h3 class="text-lg font-semibold text-slate-900 mb-6 flex items-center gap-2">
		<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-slate-500" viewBox="0 0 20 20" fill="currentColor">
			<path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd" />
		</svg>
		Evolution History
	</h3>
	
	{history.length > 0 ? (
		<ul class="relative border-l border-slate-200 ml-3 space-y-6">
			{history.map((commit) => (
				<li class="relative pl-6">
					<div class="absolute -left-[6.5px] top-1.5 h-3 w-3 rounded-full bg-slate-200 border-2 border-white"></div>
					<div class="flex flex-col sm:flex-row sm:items-baseline sm:justify-between gap-1">
						<span class="text-sm font-medium text-slate-900">{commit.message}</span>
						<time class="text-xs text-slate-500 whitespace-nowrap">
							{new Date(commit.date).toLocaleDateString('en-US', {
								year: 'numeric',
								month: 'short',
								day: 'numeric',
							})}
						</time>
					</div>
					<code class="text-[10px] text-slate-400 mt-1 uppercase tracking-wider">{commit.hash.substring(0, 7)}</code>
				</li>
			))}
		</ul>
	) : (
		<p class="text-sm text-slate-500 italic">No history available yet. This seed is fresh.</p>
	)}
</div>
