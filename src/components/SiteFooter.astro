---
import { getCollection, type CollectionEntry } from "astro:content";
import TopicFocus from "../components/Profile/TopicFocus.astro";
import GardenStats from "../components/Profile/GardenStats.astro";
import SocialLinks from "../components/Profile/SocialLinks.astro";
import {
    getProgressColors,
} from "../lib/theme";
import { getBatchFileDates, type FileDates } from "../lib/git-history";

const allNotes = await getCollection("notes");
const batchDates = (await getBatchFileDates()) as Map<string, FileDates>;

const notesWithDates = allNotes.map((note) => {
    const dates = batchDates.get(`src/content/notes/${note.id}`) ||
                  batchDates.get(`src/content/notes/${note.id}.md`) ||
                  batchDates.get(`src/content/notes/${note.id}.mdx`);

    const created = dates?.created;
    const updated = dates?.updated;

    return {
        ...note,
        displayDate: note.data.publishedDate || created || new Date(),
        updatedDate: updated || created || new Date(),
    };
});

// Sort notes for stats
const sortedNotes = notesWithDates.sort(
    (a, b) => b.displayDate.valueOf() - a.displayDate.valueOf(),
);

// Compute note counts by stage (excluding drafts for stats)
const publishedNotes = allNotes.filter((note) => note.data);
const counts = {
    all: publishedNotes.length,
    seed: publishedNotes.filter((n: any) => n.data.stage === "seed").length,
    sprout: publishedNotes.filter((n: any) => n.data.stage === "sprout")
        .length,
    evergreen: publishedNotes.filter((n: any) => n.data.stage === "evergreen").length,
};

const progressColors = getProgressColors();
---

<footer class="mt-15 pt-6 border-t border-slate-100 dark:border-slate-800">
    <div class="max-w-(--breakpoint-2xl) mx-auto">
        <div class="flex flex-col items-center gap-10 py-6">
            <div class="flex flex-col items-center gap-4">
                <div class="text-center flex flex-col gap-1">
                    <span class="text-base text-secondary">Â© <span class="text-blueprint-blue font-bold">2026 Malcolm Bastien</span></span>
                </div>
            </div>
        </div>
    </div>
</footer>
